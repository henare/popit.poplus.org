---
layout: inner-page
title: Writing to the API
---
<p>It should be possible to manage all the public data stored in a PopIt instance using the API. This includes adding, updating and deleting records.
</p>
<p>(Note - there is currently some data that cannot be managed using the API, notably image uploads.)

</p>
<h2>Authorization</h2>
<p>No authentication is required for read access. For write operations on the API you need to be authenticated. This can  either be done using <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic Authentication</a> or by cookie auth. Basic is probably best for scripts and programatic access, cookie based for Ajax calls etc.

</p>
<h2>Method summary</h2>
<p>PopIt closely follows the suggested REST method behaviours, but with a few deviations:

</p>
<table>
  <tbody><tr>
    <td>&nbsp;</td>
    <th>GET</th>
    <th>PUT</th>
    <th>POST</th>
    <th>DELETE</th>
  </tr>
  <tr>
    <th>Collection endpoint:</th>
    <td>List documents</td>
    <td><em>Not implemented</em></td>
    <td>Create document</td>
    <td><em>Not implemented</em></td>
  </tr>
  <tr>
    <th>Document endpoint:</th>
    <td>Retrieve document</td>
    <td>Update document</td>
    <td><em>Not implemented</em></td>
    <td>Delete document</td>
  </tr>
</tbody></table>

<h3>Creating a new document in a collection</h3>
<p>If you <code>POST</code> to a collection you will create a new entry.

</p>
<p>This is an example of sending a request using <a href="http://curl.haxx.se/">cURL</a> (a command line tool). The command is first, the response received from the server is printed afterwards.

</p>
<pre><code class="lang-bash">
$ curl                                                 \
    --user you@example.com:s3cr3t                      \
    --request POST                                     \
    --header <span class="string">"Accept: application/json"</span>                \
    --header <span class="string">"Content-Type: application/json"</span>          \
    --data <span class="string">'{ "name": "Joe Bloggs" }'</span>                  \
    http://test.popit.mysociety.org/api/v0.1/persons

{
  <span class="string">"result"</span>: {
    <span class="string">"id"</span>: <span class="string">"50d1f2e1c03858f9f6000006"</span>,
    <span class="string">"name"</span>: <span class="string">"Joe Bloggs"</span>
  }
}</code></pre>
<p>Note that the request was authenticated using the email address and password of the user.

</p>
<p>The <code>Content-Type</code> is set to <code>application/json</code>. This allows nested values to be correctly sent. The <code>Accept</code> header is also set to JSON, but this is not strictly necessary as PopIt will default to JSON responses (and it is currently the only format supported).

</p>
<h3>Updating an existing document</h3>
<p>Updating a document is done by sending the whole document in the <code>PUT</code> request. Any fields that are omitted in the request will be removed, and replaced with the default.

</p>
<p>When you put the order of items in arrays (like images) will be changed as well if needed.

</p>
<h3>Deleting a document</h3>
<p>Sending a <code>DELETE</code> request to a document url will cause that document to be
deleted. An empty 204 response will be returned.

</p>
<pre><code class="lang-bash">$ curl                                     \
    --user you@example.com:s3cr3t          \
    -X DELETE                              \
    http://test.127.0.0.1.xip.io:3000/api/v0.1/persons/50d1f2e1c03858f9f6000006

{}</code></pre>
<h3>Not Implemented Methods</h3>
<p>These are <code>PUT</code> and <code>DELETE</code> on collections. Implementing these would mean that you could replace an entire collection, or delete it, in one operation. It is not likely that this is something that you'll want to do often, and the penalty for doing it by mistake is high.

</p>
<p>A <code>POST</code> to a document endpoint means that you should treat the document as a collection and add an entry to it. For PopIt this makes no sense and so it is not implemented.

</p>
<p>All the not implemented methods will return the status code <code>405 Method Not Allowed</code>.
</p>
